# ============================================================================
# SNMP Exporter Configuration for Synology NAS
# ============================================================================
# Comprehensive configuration with system metrics compatible with node_exporter
# Based on Synology SNMP MIB Guide (UCD-SNMP-MIB, IF-MIB, HOST-RESOURCES-MIB)
# ============================================================================

auths:
  homelab_v2:
    community: homelab
    security_level: noAuthNoPriv
    auth_protocol: MD5
    priv_protocol: DES
    version: 2

modules:
  synology:
    walk:
      # CPU & Load - UCD-SNMP-MIB
      - 1.3.6.1.4.1.2021.10.1.5     # laLoadInt (1, 5, 15 min load avg)
      - 1.3.6.1.4.1.2021.11          # ssCpu (User, System, Idle)

      # Memory - UCD-SNMP-MIB
      - 1.3.6.1.4.1.2021.4           # memory (Total/Avail Real, Swap, Cached, Buffer)

      # Network - IF-MIB (64-bit counters)
      - 1.3.6.1.2.1.31.1.1.1.1       # ifName
      - 1.3.6.1.2.1.31.1.1.1.6       # ifHCInOctets
      - 1.3.6.1.2.1.31.1.1.1.10      # ifHCOutOctets
      - 1.3.6.1.2.1.2.2.1.8          # ifOperStatus

      # Disk/Storage - HOST-RESOURCES-MIB
      - 1.3.6.1.2.1.25.2.3.1         # hrStorage (Descr, Size, Used)

      # Disk I/O - UCD-SNMP-MIB
      - 1.3.6.1.4.1.2021.13.15.1.1   # diskIO (Device, Reads, Writes)

      # Synology-specific MIBs
      - 1.3.6.1.4.1.6574.1           # synoSystem (status, temp, fan)
      - 1.3.6.1.4.1.6574.2           # synoDisk (disk info)
      - 1.3.6.1.4.1.6574.3           # synoRaid (RAID status)
      - 1.3.6.1.4.1.6574.4           # synoUPS (UPS info if connected)

    lookups:
      # Interface name lookup for network metrics
      - source_indexes: [ifIndex]
        lookup: 1.3.6.1.2.1.31.1.1.1.1  # ifName
        drop_source_indexes: false

      # Storage description lookup
      - source_indexes: [hrStorageIndex]
        lookup: 1.3.6.1.2.1.25.2.3.1.3  # hrStorageDescr
        drop_source_indexes: false

    overrides:
      # Interface name as label
      ifName:
        ignore: true  # Use as label, not metric
        regex_extracts:
          "": ['^(.*)$']

      # Storage description as label
      hrStorageDescr:
        ignore: true  # Use as label, not metric
        regex_extracts:
          "": ['^(.*)$']

      # Fix types for counter values
      ifHCInOctets:
        type: counter
      ifHCOutOctets:
        type: counter
      diskIONRead:
        type: counter
      diskIONWritten:
        type: counter
      diskIOReads:
        type: counter
      diskIOWrites:
        type: counter

    # Explicit metric definitions
    metrics:
      # System uptime
      - name: sysUpTime
        oid: 1.3.6.1.2.1.1.3
        type: gauge
        help: System uptime in hundredths of a second

      # ========================================================================
      # CPU Metrics - UCD-SNMP-MIB (1.3.6.1.4.1.2021.11)
      # ========================================================================
      - name: ssCpuRawUser
        oid: 1.3.6.1.4.1.2021.11.50
        type: counter
        help: CPU time spent in user mode

      - name: ssCpuRawNice
        oid: 1.3.6.1.4.1.2021.11.51
        type: counter
        help: CPU time spent in nice mode

      - name: ssCpuRawSystem
        oid: 1.3.6.1.4.1.2021.11.52
        type: counter
        help: CPU time spent in system mode

      - name: ssCpuRawIdle
        oid: 1.3.6.1.4.1.2021.11.53
        type: counter
        help: CPU time spent idle

      - name: ssCpuRawWait
        oid: 1.3.6.1.4.1.2021.11.54
        type: counter
        help: CPU time spent waiting for I/O

      # Load averages
      - name: laLoadInt1
        oid: 1.3.6.1.4.1.2021.10.1.5.1
        type: gauge
        help: 1 minute load average (integer)

      - name: laLoadInt5
        oid: 1.3.6.1.4.1.2021.10.1.5.2
        type: gauge
        help: 5 minute load average (integer)

      - name: laLoadInt15
        oid: 1.3.6.1.4.1.2021.10.1.5.3
        type: gauge
        help: 15 minute load average (integer)

      # ========================================================================
      # Memory Metrics - UCD-SNMP-MIB (1.3.6.1.4.1.2021.4)
      # ========================================================================
      - name: memTotalReal
        oid: 1.3.6.1.4.1.2021.4.5
        type: gauge
        help: Total real/physical memory size in KB

      - name: memAvailReal
        oid: 1.3.6.1.4.1.2021.4.6
        type: gauge
        help: Available real/physical memory in KB

      - name: memTotalFree
        oid: 1.3.6.1.4.1.2021.4.11
        type: gauge
        help: Total free memory in KB

      - name: memBuffer
        oid: 1.3.6.1.4.1.2021.4.14
        type: gauge
        help: Memory used for buffers in KB

      - name: memCached
        oid: 1.3.6.1.4.1.2021.4.15
        type: gauge
        help: Memory used for cache in KB

      # ========================================================================
      # Network Metrics - IF-MIB (1.3.6.1.2.1.31.1.1.1)
      # ========================================================================
      - name: ifHCInOctets
        oid: 1.3.6.1.2.1.31.1.1.1.6
        type: counter
        help: Total octets received on interface (64-bit counter)
        indexes:
          - labelname: ifIndex
            type: gauge

      - name: ifHCOutOctets
        oid: 1.3.6.1.2.1.31.1.1.1.10
        type: counter
        help: Total octets transmitted on interface (64-bit counter)
        indexes:
          - labelname: ifIndex
            type: gauge

      - name: ifOperStatus
        oid: 1.3.6.1.2.1.2.2.1.8
        type: gauge
        help: Operational status of interface (1=up, 2=down)
        indexes:
          - labelname: ifIndex
            type: gauge

      # ========================================================================
      # Storage Metrics - HOST-RESOURCES-MIB (1.3.6.1.2.1.25.2.3.1)
      # ========================================================================
      - name: hrStorageAllocationUnits
        oid: 1.3.6.1.2.1.25.2.3.1.4
        type: gauge
        help: Size of allocation unit in bytes
        indexes:
          - labelname: hrStorageIndex
            type: gauge

      - name: hrStorageSize
        oid: 1.3.6.1.2.1.25.2.3.1.5
        type: gauge
        help: Size of storage in allocation units
        indexes:
          - labelname: hrStorageIndex
            type: gauge

      - name: hrStorageUsed
        oid: 1.3.6.1.2.1.25.2.3.1.6
        type: gauge
        help: Storage used in allocation units
        indexes:
          - labelname: hrStorageIndex
            type: gauge

      # ========================================================================
      # Disk I/O Metrics - UCD-SNMP-MIB (1.3.6.1.4.1.2021.13.15.1.1)
      # ========================================================================
      - name: diskIONRead
        oid: 1.3.6.1.4.1.2021.13.15.1.1.3
        type: counter
        help: Number of bytes read from disk
        indexes:
          - labelname: diskIOIndex
            type: gauge

      - name: diskIONWritten
        oid: 1.3.6.1.4.1.2021.13.15.1.1.4
        type: counter
        help: Number of bytes written to disk
        indexes:
          - labelname: diskIOIndex
            type: gauge

      - name: diskIOReads
        oid: 1.3.6.1.4.1.2021.13.15.1.1.5
        type: counter
        help: Number of read operations
        indexes:
          - labelname: diskIOIndex
            type: gauge

      - name: diskIOWrites
        oid: 1.3.6.1.4.1.2021.13.15.1.1.6
        type: counter
        help: Number of write operations
        indexes:
          - labelname: diskIOIndex
            type: gauge

      # ========================================================================
      # Synology-Specific Metrics (1.3.6.1.4.1.6574)
      # ========================================================================

      # System status
      - name: systemStatus
        oid: 1.3.6.1.4.1.6574.1.1
        type: gauge
        help: Synology system status (1=Normal, 2=Failed)

      - name: temperature
        oid: 1.3.6.1.4.1.6574.1.2
        type: gauge
        help: System temperature in Celsius

      - name: systemFanStatus
        oid: 1.3.6.1.4.1.6574.1.4.1
        type: gauge
        help: System fan status (1=Normal, 2=Failed)

      - name: cpuFanStatus
        oid: 1.3.6.1.4.1.6574.1.4.2
        type: gauge
        help: CPU fan status (1=Normal, 2=Failed)

      # RAID status
      - name: raidStatus
        oid: 1.3.6.1.4.1.6574.3.1.1.3
        type: gauge
        help: RAID volume status (1=Normal, 11=Degraded, 12=Crashed)
        indexes:
          - labelname: raidIndex
            type: gauge

      # Disk status
      - name: diskStatus
        oid: 1.3.6.1.4.1.6574.2.1.1.5
        type: gauge
        help: Disk status (1=Normal, 2=Initialized, 3=NotInitialized, 4=SystemPartitionFailed, 5=Crashed)
        indexes:
          - labelname: diskIndex
            type: gauge

      - name: diskTemperature
        oid: 1.3.6.1.4.1.6574.2.1.1.6
        type: gauge
        help: Disk temperature in Celsius
        indexes:
          - labelname: diskIndex
            type: gauge
